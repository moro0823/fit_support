<div class="container">
    <div class="profile">
      <nav>
        <div class="nav nav-tabs" id="nav-tab" role="tablist" style="margin: 0 auto;">
          <a class="nav-link active" id="nav-profile-tab" data-bs-toggle="tab" href="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false">
            Profile
          </a>
          <% if @customer.id == current_customer.id %>
          <a class="nav-link" id="nav-contact-tab" data-bs-toggle="tab" href="#nav-contact" role="tab" aria-controls="nav-contact" aria-selected="false">
            Katute
          </a>
          <a class="nav-link" id="nav-message-tab" data-bs-toggle="tab" href="#nav-message" role="tab" aria-controls="nav-message" aria-selected="false">
            Message
            <% if unchecked_notifications.any? %>
            <!--unchecked_notificationsはnotifications_helper.rbに定義-->
            <!--checked => true（未読メッセージがある時）はベルを表示-->
             <i class="far fa-bell" style="font-size: 0.7em; color: red;"></i>
            <% end %>
          </a>
          <% end %>
        </div>
      </nav>
      <div class="tab-content" id="nav-tabContent" style="margin-bottom: 10px; height: 100%;">
      <div class="tab-pane fade  show active" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
        <div class="profile-box">
          <div class="profile-side">
            <%=attachment_image_tag @customer, :profile_image, :fill,100,100,fallback: "no_image.png",size:"100x100", class:"mt-2 rounded-circle"; %>
            <div class="ml-2 mt-2 mb-2"><%= @customer.username %></div>
            <div class="button mt-3">
              <% if @customer.id == current_customer.id %>
                <p><%= link_to "フォロー中 #{@customer.following_customer.where.not(id: current_customer.id).count}",customer_follower_path(@customer) %></p>
                <p><%= link_to "フォロワー: #{@customer.follower_customer.where.not(id: current_customer.id).count}",customer_followed_path(@customer) %></p>
                <p><%= link_to "ユーザー情報編集", edit_customer_path(current_customer),class:"btn btn-info btn-sm" %></p>
                <p><%= link_to "いいねした投稿", customer_favorite_path,class:"btn btn-danger btn-sm" %></p>
                <p><%= link_to "マイ施設の編集", admin_admin_users_path, class: "btn btn-warning btn-sm" %></p>
              <% else %>
                <% if current_customer.following?(@customer) %>
                  <%= link_to 'フォロー外す', unfollow_path(@customer.id), method: :POST ,class:"btn btn-outline-danger btn-sm"%>
                <% else %>
                  <%= link_to 'フォローする', follow_path(@customer.id), method: :POST,class:"btn btn-outline-warning btn-sm"  %>
                <% end %>
              <% end %>
            </div>
            <div class="chat mt-3">
              <% if @customer.id != current_customer.id %>
                <%= link_to 'メッセージ', chat_path(@customer.id),class:"btn btn-outline-info btn-sm" %>
              <% end %>
            </div>
            <div class="follow mt-3">
              <% if @customer.id != current_customer.id %>
　　　　　　　  <p><%= link_to "フォロー中: #{@customer.following_customer.count}",customer_follower_path(@customer) %></p>
                <p><%= link_to "フォロワー: #{@customer.follower_customer.count}",customer_followed_path(@customer) %></p>
              <% end %>
            </div>
          </div>
          <div class="profile-main">
            <div class="introduction mt-2" style="color:black;"><%=simple_format @customer.introduction %></div>
            <div class="body-data">
              <div>BodyDataの公開設定</br>
              <% if @customer.is_show %>
                <p class="text-success">公開中</p>
              <% else %>
                <p class="text-danger">未公開</p>
              <% end %>
              </div>
              <% if @customer == current_customer || @customer.is_show %>
              <!--ログイン中のユーザーのマイページの時または公開中に設定しているユーザーのマイページはBodydataを表示する-->
              ---BodyData---
              <p>性別: <%= @customer.sex %></p>
              <p>年齢: <%= @customer.age%> 才</p>
              <p>身長: <%= @customer.height %> cm</p>
              <p>体重: <%= @customer.weight %> kg</p>
              <p>体脂肪率: <%= @customer.fat_percentage %> %</p>
            <% end %>

              <% if @customer.id == current_customer.id %>
              ---登録中の施設---
                <% @my_fitness_places.each do |my_fitness_place| %>
                <p class="my_fitness_place">
                  ・<%= my_fitness_place.admin_user.name %>
                </p>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
      <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">
        <% if @customer.id == current_customer.id %>
          <h5 class="karute mt-3 mb-3" style= "color:black;" >作成中のカルテ</h5>
          <% if @karutes == [] %>
            現在、作成中のカルテはありません
          <% else %>
            <% @karutes.each do |karute| %>
            <p style="color: black;">担当者: <%= link_to karute.staff_name, admin_karute_path(karute) %></p>
            <% end %>
          <% end %>
        <% end %>
      </div>

      <div class="tab-pane fade" id="nav-message" role="tabpanel" aria-labelledby="nav-message-tab">
        <% notifications = @notifications.where.not(visitor_id: current_customer.id) %>
          <!--自分に対するメッセージは通知に表示しない-->
        <% if notifications.exists? %>
          <%= render notifications %>
          <!--複数形にすることでインスタンスの数だけ部分テンプレートが呼び出される-->
          <!--１つ１つのnotificationを部分テンプレートで使用できる-->

        <% else %>
          <h5 class="message mt-3 mb-3" style= "color:black;" >新着メッセージはありません</h5>
        <% end %>
      </div>
    </div>
  </div>

  <!-----------------------------------プロフィール-------------------------------------------------->

    <div class="main">
      <% if @customer.id == current_customer.id %>
        <div class="dropdown" style="margin: 20px auto; text-align: center;">
        <button class="btn btn-secondary dropdown-toggle mt-3" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
          ジャンルごとの投稿一覧
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
          <li class="ml-2 mr-2">
            <%= form_tag(search_mypage_post_path,:method => 'get') do %>
              <%= hidden_field_tag :search, 0 %>
              <%= submit_tag 'トレーニングメニュー'%>
            <% end %>
          </li>
          <li class="mt-3 ml-2">
            <%= form_tag(search_mypage_post_path,:method => 'get') do %>
              <%= hidden_field_tag :search, 1 %>
              <%= submit_tag '食事'%>
            <% end %>
          </li>
          <li class="mt-3 ml-2">
            <%= form_tag(search_mypage_post_path,:method => 'get') do %>
              <%= hidden_field_tag :search, 2 %>
              <%= submit_tag "情報の共有" %>
            <% end %>
          </li>
        </ul>
        </div>
      <% end %>

      <% @posts.each do |posts| %>
        <div>
          <div class="card border-success mb-3" style="width: 70%; margin: 0 auto">
            <div class="card-header bg-transparent border-success">
              <% if posts.status == "トレーニングメニュー" %>
                <h5 class="text-danger"><%= posts.status %></h5>
              <% elsif posts.status == "食事" %>
                <h5 class="text-warning"><%= posts.status %></h5>
              <% else posts.status == "知識" %>
                <h5 class="text-primary"><%= posts.status %></h5>
              <% end %>
            </div>
              <div class="card-body">
                <h5 class="card-text-title"><%= link_to posts.title,post_path(posts.id),class:"text-dark" %></h5>
                  <p class="card-text"><%= simple_format posts.body %></p>
                  <div>
                    <% if posts.post_images.present? %>
                      <div class="slider">
                        <% posts.post_images.each do |image| %>
                            <%= attachment_image_tag image, :image, :fill, 300, 300, format: "jpeg" %>
                        <% end %>
                      </div>
                    <% end %>
                  </div>
                  <div>投稿日:<%= posts.updated_at.strftime("%Y/%m/%d %H:%M") %></div>
              </div>
            <div class="card-footer bg-transparent border-success">
              <span class="ml-3 mr-3"><i class="fas fa-heart mr-1" style="color:red;"></i><%= link_to posts.favorites.count,from_favorite_path(posts) %></span>
              <span class="mr-3"><i class="far fa-comment-dots mr-1"></i><%= link_to posts.post_comments.count,post_path(posts.id) %></span>
              <% if @customer.id == current_customer.id %>
              <span class="mr-2"><%= link_to "編集",edit_post_path(posts.id), class:"btn btn-info btn-sm"  %></span>
                <%= link_to "削除", post_path(posts.id), method: :delete, "data-confirm" => "本当に削除しますか？", class:"btn btn-danger btn-sm"  %>
            　<% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <div class="d-flex justify-content-center">
    <div class="page mb-5">
      <%= paginate @posts %>
    </div>
  </div>
</div>

